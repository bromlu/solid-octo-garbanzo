!function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/src/",s(s.s=1)}([function(t,e,s){"use strict";s.r(e),s.d(e,"SIZE",(function(){return a})),s.d(e,"getEl",(function(){return i})),s.d(e,"canvas",(function(){return n})),s.d(e,"LINEWIDTH",(function(){return h})),s.d(e,"TAU",(function(){return r})),s.d(e,"MAPW",(function(){return o})),s.d(e,"lerp",(function(){return l})),s.d(e,"lerpBounded",(function(){return c})),s.d(e,"randBell",(function(){return d})),s.d(e,"bounded",(function(){return u})),s.d(e,"shuffle",(function(){return m})),s.d(e,"colorDict",(function(){return y})),s.d(e,"enemyTypes",(function(){return p}));const a=1e3,i=t=>document.getElementById(t),n=i("canvas"),h=4,r=2*Math.PI,o=2*a,l=(t,e,s)=>t*(1-s)+e*s,c=(t,e,s)=>(s=Math.max(0,Math.min(s,1)),l(t,e,s)),d=(t,e=.5)=>{let s=t*e;return t+Math.random()*s-Math.random()*s},u=(t,e,s)=>Math.max(t,Math.min(s,e)),m=t=>{for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*e),a=t[e];t[e]=t[s],t[s]=a}},y={red:"#F22929",green:"#30D9A9",blue:"#05C7F2",grey:"#6D848C"},p={manta:0,boat:1,kraken:2,rock:3,seaweed:4}},function(t,e,s){"use strict";s.r(e),s.d(e,"diceManager",(function(){return dt})),s.d(e,"player",(function(){return mt})),s.d(e,"camera",(function(){return pt})),s.d(e,"enemies",(function(){return ft})),s.d(e,"obstacles",(function(){return wt})),s.d(e,"enemyBullets",(function(){return gt})),s.d(e,"playerBullets",(function(){return xt})),s.d(e,"island",(function(){return Tt})),s.d(e,"textParticles",(function(){return Mt})),s.d(e,"resourceManager",(function(){return vt})),s.d(e,"currentLevel",(function(){return bt})),s.d(e,"lastKeys",(function(){return St})),s.d(e,"gameState",(function(){return kt})),s.d(e,"startGame",(function(){return It})),s.d(e,"gameDraw",(function(){return Et})),s.d(e,"gameUpdate",(function(){return Dt})),s.d(e,"setupLevel",(function(){return At})),s.d(e,"resetGame",(function(){return _t}));var a=s(0);class i{constructor(){this.state=0,this.update=()=>{},this.draw=()=>{}}static get MENU(){return 0}static get ISLAND(){return 1}static get GAME(){return 2}static get CRED(){return 3}inState(t){return this.state==t}setState(t,e,s){console.log(t,n[t]),this.inState(t)||(this.state=t,this.update=e,this.draw=s,h(),n[t].classList.remove("nodisplay"))}tick(){let t=Date.now(),e=t-o;for(o=t,l+=e;l>=r;)this.update(),l-=r;this.draw(),requestAnimationFrame(this.tick.bind(this))}}const n={};n[i.GAME]=a.canvas,n[i.ISLAND]=Object(a.getEl)("diceMenu"),n[i.MENU]=Object(a.getEl)("menuDiv"),n[i.CRED]=Object(a.getEl)("credDiv");Object(a.getEl)("body");function h(){n[i.GAME].classList.add("nodisplay"),n[i.ISLAND].classList.add("nodisplay"),n[i.MENU].classList.add("nodisplay"),n[i.CRED].classList.add("nodisplay")}const r=1e3/30;var o=Date.now(),l=0,c=0;const d={map:"./assets/ocean.png",enemyBoat:"./assets/Enemy_Boat_Movement.png",island:"./assets/island.png",manta:"./assets/Manta_Ray.png",boat:"./assets/Boat_Movement.png",bullet:"./assets/Cannonballs.png",enemyBullet:"./assets/Monster_Attacks.png",splash:"./assets/splash.png",red:"./assets/red_face.png",blue:"./assets/blue_face.png",green:"./assets/green_face.png",grey:"./assets/grey_face.png",forward:"./assets/forward_icon.png",dash:"./assets/dash_icon.png",shield:"./assets/shield_icon.png",left_cannon:"./assets/left_cannon_icon.png",right_cannon:"./assets/right_cannon_icon.png",kraken:"./assets/Tentacle.png",text:"./assets/Text_Bubble.png",rock:"./assets/Rocks.png",forcefield:"./assets/shield.png",brokenEnemy:"./assets/Broken_Enemy_Boat.png",brokenPlayer:"./assets/Broken_Player_Boats.png",treasure1:"./assets/treasure_chest/treasure_chest1.png",treasure2:"./assets/treasure_chest/treasure_chest2.PNG",treasure3:"./assets/treasure_chest/treasure_chest3.PNG",treasure4:"./assets/treasure_chest/treasure_chest4.PNG",treasure5:"./assets/treasure_chest/treasure_chest5.PNG",seaweed:"./assets/Seaweed.png",turn:"./assets/turn_icon.png"},u={clunk:"./assets/clunk.mp3",dash:"./assets/dash.mp3",enemy_attack:"./assets/enemy_attack.mp3",hit:"./assets/hit.mp3",ocean_ambient:"./assets/ocean_ambient.mp3",shoot:"./assets/shoot.mp3",splash:"./assets/splash.mp3",music:"./assets/music_chill.mp3",shield:"./assets/force_field_short.mp3"},m={},y={};window.sounds=y;const p=()=>c==Object.keys(d).length+Object.keys(u).length,f=()=>{c++,console.log("loaded",c)},w={},g={x:-1,y:-1};Object(a.getEl)("continueBtn").addEventListener("click",()=>{kt.setState(i.GAME,Dt,Et),y.ocean_ambient.pause(),Object(a.getEl)("continueBtn").disabled=!0}),Object(a.getEl)("playBtn").addEventListener("click",()=>{p()&&It()}),Object(a.getEl)("credBtn").addEventListener("click",()=>{kt.state==i.MENU&&kt.setState(i.CRED,()=>{},()=>{})}),Object(a.getEl)("credDiv").addEventListener("click",()=>{kt.state==i.CRED&&kt.setState(i.MENU,()=>{},()=>{})});const x={parts:[],update:function(){let t=this.parts.length;for(let e=0;e<t;e++)this.parts[e].update?this.parts[e].update():(this.parts.splice(e--,1),t--)},draw:function(t){for(let e of this.parts)e.draw&&e.draw(t)},addPart:function(t,e,s){this.parts.push(T(t,e,s))},addSpiralPart:function(t,e){this.parts.push(M(t,e,color))},explode:function(t,e,s,a=20,i=10){for(let n=0;n<a;n++)this.parts.push(T(t,e,s,i))},spiral:function(t,e,s,a=20,i=10){for(let n=0;n<a;n++)this.parts.push(M(t,e,s,i))},sprayUp:function(t,e,s,a=1,i=2){for(let n=0;n<a;n++)this.parts.push(v(t,e,s,i))}};function T(t,e,s,i){return{ox:t,oy:e,x:t,y:e,r:1+i*Math.random(),v:.2,color:s,theta:Math.random()*a.TAU,draw:function(t){t.beginPath();let e=t.lineWidth;t.lineWidth=1,t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,a.TAU),t.fill(),t.closePath(),t.lineWidth=e},update:function(){if(this.x+=this.v*this.r*Math.cos(this.theta),this.y+=this.v*this.r*Math.sin(this.theta),this.r-=.1,this.r<=0)return this.update=null,void(this.draw=()=>{});this.theta+=.3-.6*Math.random()}}}function M(t,e,s,i){return{ox:t,oy:e,x:t,y:e,r:2+i*Math.random(),v:5,color:Math.random()>.7?"white":s,theta:Math.random()*a.TAU,draw:function(t){t.beginPath();let e=t.lineWidth;t.lineWidth=1,t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,a.TAU),t.fill(),t.closePath(),t.lineWidth=e},update:function(){if(this.x+=this.r*Math.cos(this.theta),this.y+=this.r*Math.sin(this.theta),this.r-=.1,this.r<=0)return this.update=null,void(this.draw=()=>{});this.theta+=.05}}}function v(t,e,s,i){return{ox:t,oy:e,x:t+60*Math.random()-30,y:e,r:1+i*Math.random(),v:.2,color:s,theta:-a.TAU/4,draw:function(t){t.beginPath();let e=t.lineWidth;t.lineWidth=1,t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,a.TAU),t.fill(),t.closePath(),t.lineWidth=e},update:function(){if(this.x+=this.v*this.r*Math.cos(this.theta),this.y+=this.v*this.r*Math.sin(this.theta),this.r-=.1,this.r<=0)return this.update=null,void(this.draw=()=>{});this.theta+=.3-.6*Math.random()}}}const b=[{x:0,y:Math.PI/-2},{x:0,y:Math.PI/2},{x:Math.PI/2,y:0},{x:Math.PI/-2,y:0},{x:0,y:0},{x:0,y:Math.PI}];class S{constructor(t,e){this.x=0,this.y=0,this.face="",this.color="",this.faceIdx=0,this.faces=t,this.colors=e,this.resolved=!1,this.done=!0,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.classList.add("gone");var s=this.canvas.getContext("webgl");this.gl=s,s||console.error("no webgl :("),this.program=webglUtils.createProgramFromScripts(s,["vertex-shader-3d","fragment-shader-3d"]),this.positionLocation=s.getAttribLocation(this.program,"a_position"),this.matrixLocation=s.getUniformLocation(this.program,"u_matrix"),this.textureLocation=s.getUniformLocation(this.program,"u_texture"),this.positionBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer),function(t){var e=new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,1,1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1]);t.bufferData(t.ARRAY_BUFFER,e.map(t=>1*t),t.STATIC_DRAW)}(s);var a=s.createTexture();s.bindTexture(s.TEXTURE_CUBE_MAP,a),this.mapFaces(t,e),this.fieldOfViewRadians=k(1),this.rotX=k(0),this.rotY=k(0),this.rotXTarget=Math.PI/4+Math.PI/2*Math.floor(3*Math.random()),this.rotYTarget=Math.PI/4+Math.PI/2*Math.floor(3*Math.random()),this.rotXVel=.001,this.rotYVel=.001,this.rollStopTime=0}mapFaces(t,e){this.faces=t,this.colors=e;const s=document.createElement("canvas").getContext("2d");s.canvas.width=128,s.canvas.height=128;[{target:this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,faceColor:e[0],textColor:"#222",text:t[0]},{target:this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,faceColor:e[1],textColor:"#222",text:t[1]},{target:this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,faceColor:e[2],textColor:"#222",text:t[2]},{target:this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,faceColor:e[3],textColor:"#222",text:t[3]},{target:this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,faceColor:e[4],textColor:"#222",text:t[4]},{target:this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,faceColor:e[5],textColor:"#222",text:t[5]}].forEach(t=>{const{target:e,faceColor:a,textColor:i,text:n}=t;!function(t,e,s,a){let i=m[e];const{width:n,height:h}=t.canvas;i?t.drawImage(i,0,0,n,h):(t.fillStyle=e,t.fillRect(0,0,n,h));let r=m[a];r?t.drawImage(r,0,0,n,h):(t.font=.7*n+"px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle=s,t.fillText(a,n/2,h/2))}(s,a,i,n);const h=this.gl.RGBA,r=this.gl.RGBA,o=this.gl.UNSIGNED_BYTE;this.gl.texImage2D(e,0,h,r,o,s.canvas)}),this.gl.generateMipmap(this.gl.TEXTURE_CUBE_MAP),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR)}contains(t,e){let s=this.x-t,a=this.y-e;return s*s+a*a<2500}draw(t,e=this.x,s=this.y){this.drawScene(),this.canvas.height=100,this.canvas.width=100,t.drawImage(this.gl.canvas,e-50,s-50,100,100)}drawScene(){let{program:t,positionLocation:e,matrixLocation:s,textureLocation:a}=this,i=this.gl,n=performance.now();n*=.001;this.then;this.then=n,i.viewport(0,0,this.canvas.width,this.canvas.height),i.enable(i.CULL_FACE),i.enable(i.DEPTH_TEST),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.useProgram(t),i.enableVertexAttribArray(e),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer);var h=i.FLOAT;i.vertexAttribPointer(e,3,h,!1,0,0);var r=this.canvas.clientWidth/this.canvas.clientHeight,o=m4.perspective(this.fieldOfViewRadians,r,1,2e3),l=m4.lookAt([0,0,200],[0,0,0],[0,1,0]),c=m4.inverse(l),d=m4.multiply(o,c);this.rotX=Math.max(this.rollStopTime-Date.now(),0)*this.rotXVel+this.rotXTarget,this.rotY=Math.max(this.rollStopTime-Date.now(),0)*this.rotYVel+this.rotYTarget;var u=d;u=m4.yRotate(u,this.rotY),u=m4.xRotate(u,this.rotX),i.uniformMatrix4fv(s,!1,u),i.uniform1i(a,0),i.drawArrays(i.TRIANGLES,0,36)}roll(t,e,s){this.rotXTarget=b[t].x+.5*Math.random()-.25,this.rotYTarget=b[t].y+.5*Math.random()-.25,this.rollStopTime=Date.now()+e,this.rotXVel=Math.random()*s+s,this.rotYVel=-.02}isDoneRolling(t){return t>=this.rollStopTime}}function k(t){return t*Math.PI/180}const I=["left_cannon","right_cannon","forward","dash","shield","X"],E=["red","blue","green","red","blue","grey"],D=[{faces:["forward","forward","forward","dash","shield","forward"],colors:["green","blue","green","blue","green","grey"]},{faces:["left_cannon","right_cannon","left_cannon","right_cannon","right_cannon","forward"],colors:["red","blue","green","red","blue","grey"]},{faces:["left_cannon","right_cannon","forward","dash","shield","right_cannon"],colors:["red","blue","green","red","blue","green"]},{faces:["dash","dash","left_cannon","right_cannon","shield","shield"],colors:["red","blue","green","red","blue","grey"]}];let A={left_cannon:1,right_cannon:1,forward:9,dash:2,shield:2,X:100},_={left_cannon:"Fire Left!",right_cannon:"Fire Right!",forward:"Forward!",dash:"Charge!",shield:"Shields Up!",X:""};class P{constructor(t,e,s){this.spritesheet=t,this.frames=e,this.frameSelector=s,this.t=Date.now()}play(){this.t=Date.now()}draw(t,e,s,a,i=1){if(null==this.frameSelector)return;if(null==this.frames||0==this.frames.length)return;if(null==this.spritesheet)return;let n=Date.now()-this.t,h=this.frames[this.frameSelector(n)],r=e-(h.ax-h.x)*i,o=s-(h.ay-h.y)*i,l=h.w*i,c=h.h*i;if(a){let s=e+(h.ax-h.x)*i;t.scale(-1,1),t.drawImage(this.spritesheet,h.x,h.y,h.w,h.h,-s,o,l,c),t.scale(-1,1)}else t.drawImage(this.spritesheet,h.x,h.y,h.w,h.h,r,o,l,c)}static getLinearFrameSelector(t,e){let s=t/e;return t=>t/s>=e?e-1:Math.floor(t/s)}static getLoopingFrameSelector(t,e){let s=t/e;return t=>Math.floor(t/s)%e}static getReversingFrameSelector(t,e){if(e<2)throw RangeError("numFrames should be greater than 2.");let s=e-1,a=t/(e=2*e-2);return t=>{let i=Math.floor(t/a)%e;return s-Math.abs(s-i)}}}const R=[{x:2379,y:497,w:378,h:364,ax:2550,ay:617},{x:2802,y:495,w:349,h:350,ax:2960,ay:607},{x:3239,y:495,w:347,h:350,ax:3396,ay:619},{x:3627,y:494,w:342,h:359,ax:3784,ay:603},{x:4012,y:493,w:328,h:354,ax:4184,ay:623},{x:4410,y:509,w:328,h:342,ax:4554,ay:617}],F=[{x:37,y:24,w:123,h:260,ax:91,ay:126},{x:187,y:23,w:125,h:256,ax:244,ay:122},{x:425,y:22,w:185,h:247,ax:544,ay:132}],L=[{x:3,y:10,w:132,h:233,ax:65,ay:102},{x:144,y:4,w:121,h:241,ax:203,ay:97},{x:324,y:10,w:196,h:229,ax:466,ay:107}],C=[{x:8,y:11,w:119,h:102,ax:55,ay:37},{x:194,y:9,w:82,h:57,ax:246,ay:27}],B=[{x:16,y:18,w:106,h:86,ax:52,ay:55},{x:149,y:11,w:91,h:69,ax:196,ay:46}],O=[{x:6,y:79,w:112,h:69,ax:59,ay:140},{x:205,y:75,w:161,h:75,ax:285,ay:138},{x:407,y:17,w:272,h:128,ax:548,ay:132}],U=[{x:19,y:47,w:173,h:231,ax:88,ay:241},{x:210,y:47,w:153,h:227,ax:281,ay:233},{x:388,y:53,w:169,h:216,ax:460,ay:230},{x:574,y:51,w:168,h:221,ax:627,ay:223},{x:748,y:23,w:185,h:257,ax:812,ay:226},{x:942,y:1,w:189,h:283,ax:1025,ay:246},{x:1148,y:3,w:230,h:294,ax:1271,ay:246},{x:1396,y:2,w:224,h:292,ax:1512,ay:253}],j=[{x:4,y:7,w:232,h:218,ax:114,ay:113},{x:244,y:6,w:242,h:215,ax:358,ay:117}];class W{constructor(t,e,s,i,n){this.x=t,this.y=e,this.vx=Object(a.randBell)(s,.2),this.vy=Object(a.randBell)(i,.2),this.sinkInst=0,this.sinking=!1,this.sunk=!1,this.friction=.95;let h=t=>this.vx*this.vx+this.vy*this.vy>100?0:1;this.animation=n?new P(m.enemyBullet,B,h):new P(m.bullet,C,h);let r=P.getLinearFrameSelector(400,O.length);this.splashAnimation=new P(m.splash,O,r)}draw(t){if(this.sunk)return;if(this.sinking&&this.y<0)return void this.splashAnimation.draw(t,this.x,this.y,!1,.4);t.save(),t.translate(this.x,this.y);let e=Math.atan2(this.vy,this.vx);t.rotate(e+3*Math.PI/4),this.animation.draw(t,0,0,!1,.4),t.restore()}update(){this.sinking?Date.now()>=this.sinkInst&&(this.sunk=!0):(this.x+=this.vx,this.y+=this.vy,this.vx*=this.friction,this.vy*=this.friction,Math.abs(this.vx)+Math.abs(this.vy)<4&&(this.sinking=!0,this.splashAnimation.play(),this.sinkInst=Date.now()+400))}}const V=["We've been hit!","We're going down!","We're going down!"],{SIZE:Z,bounded:X,TAU:N}=s(0);class H{constructor(t,e,s,i){if(this.x=t,this.y=e,this.theta=0,this.AI=s,this.type=i,this.r=32,this.a=0,this.aTheta=0,this.v=0,this.vTheta=0,this.forceTheta=.02,this.force=1,this.friction=.9,this.frictionTheta=.8,this.reloadTime=3e3,this.lastShot=0,this.numBullets=3,this.bulletV=30,this.health=100,this.sinkInst=0,this.sinking=!1,this.sunk=!1,i==a.enemyTypes.manta){let t=P.getLoopingFrameSelector(1e3,R.length);this.animation=new P(m.manta,R,t)}else if(i==a.enemyTypes.boat){let t=P.getLoopingFrameSelector(1e3,2);this.animation=new P(m.enemyBoat,L,t)}let n=P.getLinearFrameSelector(400,O.length);this.splashAnimation=new P(m.splash,O,n)}update(){if(this.sinking)return Date.now()>=this.sinkInst&&(this.sunk=!0),void(this.type==a.enemyTypes.boat&&this.sinkInst-Date.now()<800&&!this.splashAnimation.played&&(this.splashAnimation.play(),this.splashAnimation.played=!0));this.AI.update&&this.AI.update(this),this.v*=this.friction,this.vTheta*=this.frictionTheta,Math.abs(this.v)<.01&&(this.v=0),Math.abs(this.vTheta)<.01&&(this.vTheta=0),this.AI.goForward(this)?this.a=this.force:this.a=0,this.v+=this.a,this.AI.goLeft(this)?this.aTheta=-this.forceTheta:this.AI.goRight(this)?this.aTheta=this.forceTheta:this.aTheta=0,this.vTheta+=this.aTheta,this.theta+=this.vTheta,this.x+=this.v*Math.sin(this.theta),this.y-=this.v*Math.cos(this.theta),this.x=Object(a.bounded)(-a.SIZE,this.x,a.SIZE),this.y=Object(a.bounded)(Tt.y,this.y,0);let t=Date.now();if(this.AI.useShot(this)&&t>this.lastShot+this.reloadTime){y.shoot.volume=.02,y.shoot.currentTime=0,y.shoot.play();let e=this.AI.useRightSide,s=this.numBullets,a=Math.PI/2;if(e)for(let t=0;t<s;t++){let e=this.theta+Math.PI/2-a/2+(t+1)*(a/(s+2)),i=Math.sin(e)*this.bulletV,n=-Math.cos(e)*this.bulletV;gt.push(new W(this.x,this.y,i,n,!0))}else for(let t=0;t<s;t++){let e=this.theta-Math.PI/2-a/2+(t+1)*(a/(s+2)),i=Math.sin(e)*this.bulletV,n=-Math.cos(e)*this.bulletV;gt.push(new W(this.x,this.y,i,n,!0))}this.lastShot=t}}draw(t){let e=this.sinking&&this.type==a.enemyTypes.boat&&!this.splashAnimation.played;this.sunk||(this.sinking&&(e||this.splashAnimation.draw(t,this.x,this.y,!1,.4)),t.save(),t.translate(this.x,this.y),t.rotate(this.theta),e?(t.scale(.4,.4),t.drawImage(m.brokenEnemy,-81.5,-117.5)):this.sinking||this.animation.draw(t,0,0,!1,.4),t.restore())}handleCollision(){this.health-=100,this.health<=0&&(this.sinking=!0,this.splashAnimation.play(),this.sinkInst=Date.now()+400,this.type==a.enemyTypes.boat&&(this.sinkInst+=800),y.splash.volume=.2,y.splash.currentTime=0,y.splash.play())}}class G{constructor(t,e,s){if(this.x=t,this.y=e,this.r=32,this.type=s,this.theta=0,this.health=100,this.showHideDuration=1100,this.showHideTarget=Date.now()+this.showHideDuration,this.sinkInst=0,this.sinking=!1,this.sunk=!1,this.hideInst=0,this.hiding=!1,this.hidden=!1,this.showInst=0,this.showing=!1,this.shown=!0,this.flip=mt.x<this.x,s==a.enemyTypes.kraken){let t=P.getLinearFrameSelector(1e3,U.length);this.animation=new P(m.kraken,U,t)}else a.enemyTypes.rock;let i=P.getLinearFrameSelector(400,O.length);this.splashAnimation=new P(m.splash,O,i),this.lastShot=Date.now(),this.reloadTime=2200,this.bulletV=30}update(){if(this.type===a.enemyTypes.kraken){if(Date.now()>this.lastShot+this.reloadTime&&this.hiding){y.enemy_attack.volume=.05,y.enemy_attack.currentTime=.3,y.enemy_attack.play();let t=!this.flip,e=1;Math.PI;if(t)for(let t=0;t<e;t++){let t=this.theta+Math.PI/2,e=Math.sin(t)*this.bulletV,s=-Math.cos(t)*this.bulletV;gt.push(new W(this.x,this.y,e,s,!0))}else for(let t=0;t<e;t++){let t=this.theta-Math.PI/2,e=Math.sin(t)*this.bulletV,s=-Math.cos(t)*this.bulletV;gt.push(new W(this.x,this.y,e,s,!0))}this.lastShot=Date.now()}this.sinking?Date.now()>=this.sinkInst&&(this.sunk=!0,this.sinking=!1):this.hiding?Date.now()>=this.hideInst&&(this.hidden=!0,this.hiding=!1):this.showing?Date.now()>=this.showInst&&(this.shown=!0,this.showing=!1):(this.shown&&Date.now()>=this.showHideTarget&&(this.shown=!1,this.hiding=!0,this.splashAnimation.play(),this.hideInst=Date.now()+400,this.showHideTarget=Date.now()+this.showHideDuration),this.hidden&&Date.now()>=this.showHideTarget&&(this.x+=100*Math.random()*(Math.random()>.5?-1:1),this.y+=100*Math.random()*(Math.random()>.5?-1:1),Object(a.bounded)(-a.SIZE,this.x,a.SIZE),this.y=Object(a.bounded)(Tt.y,this.y,0),this.flip=mt.x<this.x,this.animation.play(),this.hidden=!1,this.showing=!0,this.splashAnimation.play(),this.showInst=Date.now()+400,this.showHideTarget=Date.now()+this.showHideDuration,y.splash.volume=.02,y.splash.currentTime=0,y.splash.play()))}}draw(t){return this.type===a.enemyTypes.rock?(t.save(),t.translate(this.x,this.y),t.drawImage(m.rock,-32,-32,64,64),void t.restore()):this.type===a.enemyTypes.seaweed?(t.save(),t.translate(this.x,this.y),t.drawImage(m.seaweed,-32,-32,64,64),void t.restore()):void(this.sunk||this.hidden||(this.sinking||this.hiding||this.showing?this.splashAnimation.draw(t,this.x,this.y,!1,.4):(t.save(),t.translate(this.x,this.y),this.animation.draw(t,0,0,this.flip,.4),t.restore())))}handleCollision(){this.type===a.enemyTypes.kraken&&(this.health-=100,this.health<=0&&(this.sinking=!0,this.splashAnimation.play(),this.sinkInst=Date.now()+400,y.splash.volume=.2,y.splash.currentTime=0,y.splash.play()))}}const Y=0,z=1,J=2;class q{constructor(t){this.actionDurationMax=t,this.actionDuration=Math.random()*this.actionDurationMax,this.actionStart=Date.now(),this.action=Math.floor(4*Math.random())}goForward(){return this.action===Y}goLeft(){return this.action===z}goRight(){return this.action===J}useShot(){return!1}update(t){Date.now()-this.actionStart>this.actionDuration&&(this.action=Math.floor(4*Math.random()),this.actionStart=Date.now(),this.actionDuration=Math.random()*this.actionDurationMax)}}class K{constructor(t){this.patrolDuration=t,this.patrolStart=Date.now(),this.rotationTarget=Math.PI,this.precision=.1}goForward(t){if(Date.now()-this.patrolStart<this.patrolDuration)return!0}goLeft(t){if(Date.now()-this.patrolStart>this.patrolDuration){if(t.theta>this.rotationTarget)return!0;Math.abs(t.theta-this.rotationTarget)<=this.precision&&(this.patrolStart=Date.now(),this.rotationTarget=t.theta+Math.PI)}return!1}goRight(t){if(Date.now()-this.patrolStart>this.patrolDuration){if(t.theta<this.rotationTarget)return!0;Math.abs(t.theta-this.rotationTarget)<=this.precision&&(this.patrolStart=Date.now(),this.rotationTarget=t.theta+Math.PI)}return!1}useShot(){return!1}}const Q=0,$=1;class tt{constructor(t){this.target=t,this.xOffset=Math.floor(100*Math.random())-50,this.yOffset=Math.floor(100*Math.random())-50,this.forward=!1,this.left=!1,this.right=!1,this.state=Q,this.shotDistance=300,this.useRightSide=!1,this.shoot=!1}goForward(){return this.forward}goLeft(){return this.left}goRight(){return this.right}useShot(){return this.shoot}update(t){let e=t.x-this.target.x,s=t.y-this.target.y;if(this.left=!1,this.right=!1,this.shoot=!1,this.forward=!1,this.state==Q){e+=this.xOffset,s+=this.yOffset,this.forward=!0;let a=Math.atan2(s,e),i=et(t.theta,a),n=et(t.theta+Math.PI,a);Math.abs(i)<Math.abs(n)?this.left=!0:this.right=!0,e=Math.abs(e),s=Math.abs(s),e<this.shotDistance&&s<this.shotDistance&&(this.state=$,this.useRightSide=Math.abs(n)<Math.abs(i))}else if(this.state==$){let a=Math.atan2(s,e),i=et(t.theta+Math.PI/2,a),n=et(t.theta-Math.PI/2,a);Math.abs(Math.abs(i)-Math.abs(n))<.3?this.shoot=!0:Math.abs(i)<Math.abs(n)?this.useRightSide?this.left=!0:this.right=!0:this.useRightSide?this.right=!0:this.left=!0,e=Math.abs(e),s=Math.abs(s),(e>this.shotDistance||s>this.shotDistance)&&(this.state=Q)}}}function et(t,e){let s=e-t;for(;s>Math.PI;)s-=a.TAU;for(;s<-Math.PI;)s+=a.TAU;return s}function st(t){let e=[];for(let s=0;s<t;s++)e.push(new G(Math.random()*a.MAPW-a.MAPW/2,Math.random()*(Tt.y+100)-100,a.enemyTypes.rock));return e}function at(t){let e=[];for(let s=0;s<t;s++)e.push(new G(Math.random()*a.MAPW-a.MAPW/2,Math.random()*(Tt.y+100)-100,a.enemyTypes.seaweed));return e}function it(t){let e=[];for(let s=0;s<t;s++)e.push(new G(Math.random()*a.MAPW,Math.random()*(Tt.y+100)-100,a.enemyTypes.kraken));return e}function nt(t){let e=[];for(let s=0;s<t;s++)e.push(new H(Math.random()*a.MAPW,Math.random()*(Tt.y+100)-100,new q(1e3),a.enemyTypes.manta));return e}function ht(t){let e=[];for(let s=0;s<t;s++)e.push(new H(Math.random()*a.MAPW,Math.random()*(Tt.y+100)-100,new K(1e3),a.enemyTypes.manta));return e}function rt(t){let e=[];for(let s=0;s<t;s++)e.push(new H(Math.random()*a.MAPW,Math.random()*(Tt.y+100)-100,new tt(mt),a.enemyTypes.boat));return e}const ot=["Wheel's stuck!","Can't seem to turn!"];const lt=Object(a.getEl)("treasureCanvas").getContext("2d");const ct=a.canvas.getContext("2d");a.canvas.width=a.SIZE,a.canvas.height=a.SIZE;const dt=new class{constructor(){this.allDice=[],this.rollDuration=1e3,this.maxRollDuration=1500,this.lastRoll=0,this.force=0,this.forceVel=.005,this.maxForce=.15,this.rolling=!1,this.rollStart=0}addDiceForLevel(t){let e=D[t-1];this.addDice(e.faces,e.colors)}resetDice(){this.allDice.forEach(t=>{t.rotXTarget=Math.PI/4+Math.PI/2*Math.floor(3*Math.random()),t.rotYTarget=Math.PI/4+Math.PI/2*Math.floor(3*Math.random()),t.face=""})}increaseForce(){this.force+=this.forceVel}getBoundedForce(){return this.maxForce}addDice(t,e){this.allDice.push(new S(t,e)),this.setDicePositions()}addStandardDice(){this.addDice(I,E)}setDicePositions(){let t=this.allDice.length,e=.9*a.SIZE;for(let s=0;s<t;s++){let i=.9*a.SIZE,n=a.SIZE/2-e/2+(s+1)*(e/(t+1)),h=this.allDice[s];h.x=n,h.y=i}}draw(t){this.allDice.forEach(e=>{!this.rolling&&e.resolved?(t.globalAlpha=.2,e.draw(t),t.globalAlpha=1):e.draw(t),e.hover&&(t.beginPath(),t.arc(e.x,e.y,50,0,a.TAU),t.strokeStyle="yellow",t.stroke(),t.closePath(),this.drawToolTip(t,e.face))})}drawToolTip(t,e){let s=_[e];if(!s)return;t.font="20px Grenze Gotisch",t.textAlign="center",t.textBaseline="middle";let a=t.measureText(s).width+20,i=g.x,n=g.y-30;t.drawImage(m.text,i-a/2,n-25,a,50),t.fillStyle="#222",t.fillText(s,i,n)}drawBar(t){if(this.force>0){t.fillStyle="red",t.strokeStyle="#555";let e=this.getBoundedForce()/this.maxForce*100;t.strokeRect(mt.x-50,mt.y+50,100,10),t.fillRect(mt.x-e/2,mt.y+50,e,10)}}rollAll(){this.lastRoll=Date.now();let t=this.allDice.length;this.force=this.getBoundedForce(),this.rollDuration=Object(a.lerp)(500,2e3,(this.maxForce-this.force)/this.maxForce);for(let e=0;e<t;e++){let t=this.allDice[e];t.hover=!1;let s=Math.floor(6*Math.random());t.roll(s,Object(a.randBell)(this.rollDuration,.3),this.force),t.done=!1,t.face=t.faces[s],t.color=t.colors[s],t.faceIdx=s}this.force=0,this.rolling=!0,this.rollStart=Date.now()}onRollFinished(){this.rolling=!1,this.force=0}update(){const t=Date.now();if(this.rolling){if(Date.now()<=this.rollStart+.8*this.rollDuration)return;let e=0;for(let s of this.allDice)s.done?e++:(s.done=s.isDoneRolling(t),s.done&&(e++,y.clunk.volume=.5,y.clunk.currentTime=0,y.clunk.play(),s.resolved=!1));e==this.allDice.length&&this.onRollFinished()}else if(this.allResolved())this.rollAll();else for(let t of this.allDice)if(t.hover=!1,!t.resolved&&t.contains(g.x,g.y)){if(t.hover=!0,!St[0]&&w[0])return void this.resolveDice(t);if(!St[2]&&w[2])return void this.resolveDiceColor(t)}}resolveDice(t){switch(t.face){case"dash":mt.startDash();break;case"forward":mt.startForward();break;case"left_cannon":mt.shootLeft();break;case"right_cannon":mt.shootRight();break;case"shield":mt.shieldUp()}t.resolved=!0}resolveDiceColor(t){let e=t.color,s=0;for(let e of this.allDice)if(!e.resolved&&e.color==t.color){e.resolved=!0;let i=Math.ceil(s/2)+1;s+=i,Mt.newTextPart(e.x,e.y-30,a.colorDict[t.color],"+"+i)}vt.add(s,e)}allResolved(){for(let t=0;t<this.allDice.length;t++)if(!this.allDice[t].resolved)return!1;return!0}loseFace(){let t=100,e=null;for(let s=0;s<this.allDice.length;s++){let a=this.allDice[s],i=A[a.face];i<t&&(e=a,t=i)}null!=e?(e.mapFaces(e.faces.map((t,s)=>s==e.faceIdx?"X":t),e.colors.map((t,s)=>s==e.faceIdx?"grey":t)),e.face="X",e.color="grey"):mt.sinking||(mt.sinking=!0,mt.sinkInst=Date.now()+2e3,mt.showMessage("It looks like the end for us..."))}};window.diceManager=dt;const ut=new class{constructor(){}update(){xt.forEach(t=>{t.sinking||t.sunk||(ft.forEach(e=>{if(e.sinking||e.sunk)return;let s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);s<e.r&&a<e.r&&(t.sunk=!0,this.handleEnemyHurt(e))}),wt.forEach(e=>{if(e.type!==a.enemyTypes.kraken||!e.shown)return;let s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);s<e.r&&i<e.r&&(t.sunk=!0,this.handleObstacleHurt(e))}))}),gt.forEach(t=>{if(t.sinking||t.sunk)return;let e=Math.abs(t.x-mt.x),s=Math.abs(t.y-mt.y);e<mt.r&&s<mt.r&&(t.sunk=!0,mt.isDashing()||this.handlePlayerHurt())}),ft.forEach(t=>{let e=Math.abs(t.x-mt.x),s=Math.abs(t.y-mt.y);e<mt.r&&s<mt.r&&(mt.isDashing()?this.handleEnemyHurt(t):this.handlePlayerHurt())}),wt.forEach(t=>{if(!t.shown)return;let e=Math.abs(t.x-mt.x),s=Math.abs(t.y-mt.y);e<mt.r+t.r&&s<mt.r+t.r&&(mt.isDashing()?this.handleObstacleHurt(t):this.handlePlayerHurt(t))})}handleEnemyHurt(t){(y.hit.currentTime>1||0==y.hit.currentTime)&&(y.hit.volume=.05,y.hit.currentTime=.85,y.hit.play()),t.handleCollision()}handlePlayerHurt(t){mt.handleCollision(t)}handleObstacleHurt(t){(y.hit.currentTime>1||0==y.hit.currentTime)&&(y.hit.volume=.05,y.hit.currentTime=.85,y.hit.play()),t.handleCollision()}},mt=new class{constructor(){this.x=0,this.y=0,this.theta=0,this.r=16,this.a=0,this.aTheta=0,this.v=10,this.vTheta=0,this.forceTheta=.02,this.force=1,this.forceStuck=!1,this.friction=.9,this.frictionTheta=.8,this.hurtTimer=0,this.chargingSpecial=!1,this.bulletV=30,this.afterImages=[],this.lastDash=0,this.forwardEnd=0,this.message="",this.lastMessageInst=0,this.shield=!1,this.shieldInst=0,this.sinkInst=0,this.sinking=!1}reset(){this.x=0,this.y=0,this.theta=0,this.a=0,this.aTheta=0,this.v=10,this.vTheta=0,this.forceTheta=.02,this.force=1,this.forceStuck=!1,this.friction=.9,this.frictionTheta=.8,this.hurtTimer=0,this.chargingSpecial=!1,this.bulletV=30,this.afterImages=[],this.lastDash=0,this.message="",this.lastMessageInst=0,this.shield=!1,this.shieldInst=0,this.sinkInst=0,this.sinking=!1,this.invincibleEnd=0}setAnimations(){let t=P.getLoopingFrameSelector(1e3,2);this.moveAnimation=new P(m.boat,F,t),this.stillAnimation=new P(m.boat,F,t=>0),this.turnAnimation=new P(m.boat,F,t=>2),this.shieldAnimation=new P(m.forcefield,j,P.getLoopingFrameSelector(500,2))}draw(t){t.save();let e=this.x,s=this.y,a=this.theta;if(t.translate(e,s),t.rotate(this.theta),this.sinking)return t.scale(.4,.4),t.drawImage(m.brokenPlayer,-81.5,-117.5),void t.restore();if(this.invincibleEnd>Date.now()&&(t.globalAlpha=.5+.5*Math.sin(Date.now())),this.v>2?this.moveAnimation.draw(t,0,0,!1,.4):this.vTheta>.07?this.turnAnimation.draw(t,0,0,!0,.4):this.vTheta<-.07?this.turnAnimation.draw(t,0,0,!1,.4):this.stillAnimation.draw(t,0,0,!1,.4),this.shield&&this.shieldAnimation.draw(t,0,0,!1,.5),t.restore(),this.isDashing()){for(let e=0;e<this.afterImages.length;e+=2){let s=this.afterImages[e];t.save(),t.translate(s.x,s.y),t.rotate(s.theta),t.globalAlpha=.3,this.moveAnimation.draw(t,0,0,!1,.4),t.globalAlpha=1,t.restore()}this.afterImages.push({x:e,y:s,theta:a})}}update(){this.sinking?Date.now()>this.sinkInst&&(kt.setState(i.MENU,()=>{},()=>{}),_t()):(this.shield?(this.r=32,Date.now()-this.shieldInst>500&&(vt.useControl(),vt.control<=0&&(this.shield=!1))):this.r=16,this.v*=this.friction,this.vTheta*=this.frictionTheta,Math.abs(this.v)<.01&&(this.v=0),Math.abs(this.vTheta)<.01&&(this.vTheta=0),this.forwardEnd>Date.now()?this.a=this.force:this.a=0,this.v+=this.a,this.forceStuck&Math.random()<.1&&(this.force=3*Math.random()),w[65]&&vt.rudder>0?(this.aTheta=-this.forceTheta,vt.useRudder()):w[68]&&vt.rudder>0?(this.aTheta=this.forceTheta,vt.useRudder()):this.aTheta=0,this.vTheta+=this.aTheta,this.theta+=this.vTheta,this.x+=this.v*Math.sin(this.theta),this.y-=this.v*Math.cos(this.theta),this.y>0&&(this.y=0),this.x=Object(a.bounded)(-a.SIZE,this.x,a.SIZE))}startForward(){this.forwardEnd=Date.now()+2e3,Math.random()<.4&&this.showMessage("Onward!")}startDash(){this.v+=45,this.lastDash=Date.now(),this.afterImages=[],Math.random()<.4&&this.showMessage("Full steam ahead!"),y.dash.volume=.2,y.dash.currentTime=0,y.dash.play()}shootRight(){let t=Math.ceil(vt.ammo);if(t>5&&(t=5),0==t)return void console.log("no ammo");vt.useAmmo(t),y.shoot.volume=.02,y.shoot.currentTime=0,y.shoot.play();let e=Math.PI/2;for(let s=0;s<t;s++){let a=this.theta+Math.PI/2-e/2+(s+1)*(e/(t+2)),i=Math.sin(a)*this.bulletV,n=-Math.cos(a)*this.bulletV;xt.push(new W(this.x,this.y,i,n,!1))}}shootLeft(){let t=Math.ceil(vt.ammo);if(t>5&&(t=5),vt.useAmmo(t),0==t)return void console.log("no ammo");y.shoot.volume=.02,y.shoot.currentTime=0,y.shoot.play();let e=Math.PI/2;for(let s=0;s<t;s++){let a=this.theta-Math.PI/2-e/2+(s+1)*(e/(t+2)),i=Math.sin(a)*this.bulletV,n=-Math.cos(a)*this.bulletV;xt.push(new W(this.x,this.y,i,n,!1))}}handleCollision(t){return t&&t.type===a.enemyTypes.seaweed?(this.force=.5,void setTimeout(()=>{this.force=1},500)):this.shield&&0==y.shield.currentTime||y.shield.currentTime>1?(y.shield.currentTime=0,y.shield.volume=.09,void y.shield.play()):void(this.invincibleEnd>Date.now()||(this.invincibleEnd=Date.now()+1e3,y.hit.volume=.05,y.hit.currentTime=.85,y.hit.play(),console.log("hit"),this.chargingSpecial=!1,dt.loseFace(),Date.now()-this.lastMessageInst>2e3&&Math.random()<.4&&this.showHurtMessage()))}isDashing(){return this.v>15&&Date.now()-this.lastDash<1e3}shieldUp(){this.shield=!0,this.shieldInst=Date.now()}showHurtMessage(){this.showMessage(V[Math.floor(Math.random()*V.length)])}showMessage(t,e){!e&&Date.now()-this.lastMessageInst<2e3||("string"==typeof t?this.message=t:t=t[Math.floor(Math.random()*t.length)],this.message=t,this.lastMessageInst=Date.now())}drawMessage(t){let e=Date.now()-this.lastMessageInst;if(e>1500)return;t.font="30px Grenze Gotisch",t.textAlign="center",t.textBaseline="middle";let s=t.measureText(this.message).width+30,a=this.x,i=this.y-60;t.globalAlpha=1-e/1500,t.drawImage(m.text,a-s/2,i-30,s,60),t.fillStyle="#222",t.fillText(this.message,a,i),t.globalAlpha=1}};window.player=mt;const yt=new class{constructor(){this.enemiesToSpawn=[],this.obstaclesToSpawn=[]}update(){this.updateEnemies(),this.updateObstacles()}updateEnemies(){let t=this.enemiesToSpawn[this.enemiesToSpawn.length-1];t&&pt.yAnchor-100<=t.y&&ft.push(this.enemiesToSpawn.pop())}updateObstacles(){let t=this.obstaclesToSpawn[this.obstaclesToSpawn.length-1];t&&pt.yAnchor-100<=t.y&&obstacles.push(this.obstaclesToSpawn.pop())}addSpawnsForLevel(t){[null,this.addLevel1Spawns,this.addLevel2Spawns,this.addLevel3Spawns,this.addLevel4Spawns][t].call(this)}addLevel1Spawns(){this.obstaclesToSpawn=[new G(-1050,-1445,a.enemyTypes.rock),new G(-923,-1424,a.enemyTypes.rock),new G(-812,-1478,a.enemyTypes.rock),new G(-712,-1476,a.enemyTypes.rock),new G(-623,-1478,a.enemyTypes.rock),new G(-533,-1405,a.enemyTypes.rock),new G(-447,-1452,a.enemyTypes.rock),new G(-342,-1478,a.enemyTypes.rock),new G(-242,-1475,a.enemyTypes.rock),new G(-122,-1423,a.enemyTypes.rock),new G(0,-1400,a.enemyTypes.rock),new G(198,-1400,a.enemyTypes.rock),new G(200,-1400,a.enemyTypes.rock),new G(385,-1400,a.enemyTypes.rock),new G(578,-1400,a.enemyTypes.rock),new G(-688,-1e3,a.enemyTypes.seaweed),new G(-550,-1050,a.enemyTypes.seaweed),new G(-458,-1050,a.enemyTypes.seaweed),new G(-350,-1050,a.enemyTypes.seaweed),new G(-288,-1010,a.enemyTypes.seaweed),new G(-150,-1050,a.enemyTypes.seaweed),new G(10,-1010,a.enemyTypes.seaweed),new G(170,-1070,a.enemyTypes.seaweed),new G(280,-1080,a.enemyTypes.seaweed),new G(310,-1010,a.enemyTypes.seaweed),new G(420,-1020,a.enemyTypes.seaweed),new G(540,-1040,a.enemyTypes.seaweed),new G(620,-1020,a.enemyTypes.seaweed),new G(740,-1040,a.enemyTypes.seaweed),new G(860,-1060,a.enemyTypes.seaweed),new G(940,-1040,a.enemyTypes.seaweed),new G(1050,-1050,a.enemyTypes.seaweed),new G(-1022,-545,a.enemyTypes.rock),new G(-900,-535,a.enemyTypes.rock),new G(-887,-545,a.enemyTypes.rock),new G(-700,-521,a.enemyTypes.rock),new G(-607,-545,a.enemyTypes.rock),new G(-500,-521,a.enemyTypes.rock),new G(-478,-557,a.enemyTypes.rock),new G(-358,-578,a.enemyTypes.rock),new G(-200,-521,a.enemyTypes.rock),new G(-100,-562,a.enemyTypes.rock),new G(0,-524,a.enemyTypes.rock),new G(175,-542,a.enemyTypes.rock),new G(278,-504,a.enemyTypes.rock),new G(325,-556,a.enemyTypes.rock),new G(400,-504,a.enemyTypes.rock),new G(575,-545,a.enemyTypes.rock)]}addLevel2Spawns(){console.log("lev2"),this.enemiesToSpawn=[...nt(10)],this.obstaclesToSpawn=[...st(100),...at(100),...it(5)],this.enemiesToSpawn=this.enemiesToSpawn.sort((function(t,e){return t.y-e.y})),this.obstaclesToSpawn=this.obstaclesToSpawn.sort((function(t,e){return t.y-e.y})),console.log(this.enemiesToSpawn)}addLevel3Spawns(){console.log("lev3"),this.enemiesToSpawn=[...rt(5),...nt(15),...ht(15)],this.obstaclesToSpawn=[...st(100),...at(100),...it(10)],this.enemiesToSpawn=this.enemiesToSpawn.sort((function(t,e){return t.y-e.y})),this.obstaclesToSpawn=this.obstaclesToSpawn.sort((function(t,e){return t.y-e.y}))}addLevel4Spawns(){console.log("lev4"),this.enemiesToSpawn=[...rt(10),...nt(20),...ht(20)],this.obstaclesToSpawn=[...st(150),...at(150),...it(40)],this.enemiesToSpawn=this.enemiesToSpawn.sort((function(t,e){return t.y-e.y})),this.obstaclesToSpawn=this.obstaclesToSpawn.sort((function(t,e){return t.y-e.y}))}};window.spawner=yt;const pt=new class{constructor(){this.xAnchor=0,this.yAnchor=0,this.x=this.xAnchor,this.y=this.yAnchor,this.vel=5,this.xShakeFactor=0,this.yShakeFactor=0,this.xShakeSeed=0,this.yShakeSeed=0}shake(t){let e=(Math.random()-Math.random())*t/5,s=(Math.random()-Math.random())*t/5;this.xShakeFactor=t+e,this.yShakeFactor=t+s;let a=Math.random();this.xShakeSeed=a*N,this.yShakeSeed=a*N}setTarget(t){this.target=t}update(){if(this.xShakeFactor>0){let t=Date.now();this.x=this.xAnchor+this.xShakeFactor*Math.sin(this.xShakeSeed-t),this.y=this.yAnchor+this.yShakeFactor*Math.cos(this.yShakeSeed-t),this.xShakeFactor*=.9,this.yShakeFactor*=.9,this.xShakeFactor<.5&&(this.xShakeFactor=0,this.yShakeFactor=0)}let t=this.xAnchor-this.x,e=this.yAnchor-this.y;this.xShakeFactor<=0&&(Math.abs(t)<.001&&(this.x=this.xAnchor),Math.abs(e)<.001&&(this.y=this.yAnchor)),this.x+=t/2,this.y+=e/2,null!=this.target&&(this.xAnchor=this.target.x-Z/2,this.yAnchor=this.target.y-Z/2,this.xAnchor=X(-Z,this.xAnchor,0))}moveCtx(t){t.translate(-Math.round(this.x),-Math.round(this.y))}};window.camera=pt;const ft=[];window.enemies=ft;const wt=[];window.obstacles=wt;const gt=[],xt=[],Tt=new class{constructor(t=-2e3){this.y=t}draw(t){let e=a.MAPW,s=e/2;t.drawImage(m.island,-a.SIZE,this.y-s+100,e,s)}drawPreviousIsland(t){let e=a.MAPW,s=e/2;t.drawImage(m.island,-a.SIZE,-20,e,s)}},Mt=new class{constructor(){this.parts=[]}update(){let t=this.parts.length;for(let e=0;e<t;e++)this.parts[e].update?this.parts[e].update():(this.parts.splice(e--,1),t--)}draw(t){for(let e of this.parts)e.draw&&e.draw(t)}newTextPart(t,e,s,a){this.parts.push(function(t,e,s,a){return{x:t,y:e,color:s,o:1,draw(t){t.font="30px Grenze Gotisch",t.textAlign="center",t.textBaseline="middle",t.globalAlpha=Math.round(10*this.o)/10,t.fillStyle=s,t.fillText(a,this.x,this.y),t.globalAlpha=1},update(){this.y-=1,this.o-=.03,this.o<=0&&(this.update=null)}}}(t,e,s,a))}},vt=new class{constructor(){this.ammo=10,this.maxAmmo=20,this.ammoStep=this.maxAmmo/20,this.control=100,this.maxControl=200,this.controlStep=this.maxControl/20,this.rudder=150,this.maxRudder=300,this.rudderStep=this.maxRudder/20}useAmmo(t){this.ammo-=t,this.ammo<0&&(this.ammo=0)}useRudder(){this.rudder--,this.rudder<=0&&(this.rudder=0,player.showMessage(ot))}useControl(){this.control--,this.control<0&&(this.control=0)}add(t,e){if("red"==e)this.ammo+=t*this.ammoStep;else if("blue"==e)this.control+=t*this.controlStep;else if("green"==e)this.rudder+=t*this.rudderStep;else if("grey"==e)for(let e=0;e<t;e++){let t=Math.random();t<.333?this.ammo+=this.ammoStep:t<.666?this.control+=this.controlStep:this.rudder+=this.rudderStep}this.ammo=Object(a.bounded)(0,this.ammo,this.maxAmmo),this.control=Object(a.bounded)(0,this.control,this.maxControl),this.rudder=Object(a.bounded)(0,this.rudder,this.maxRudder)}draw(t){t.strokeStyle="#222",t.fillStyle=a.colorDict.red;let e=20,s=20,i=Object(a.lerp)(0,150,this.ammo/this.maxAmmo);t.fillRect(e,a.SIZE-i-20-s,s,i),t.strokeRect(e,a.SIZE-150-20-s,s,150),t.drawImage(m.right_cannon,e-10,a.SIZE-20-s,40,40),e+=40,t.fillStyle=a.colorDict.blue,i=Object(a.lerp)(0,150,this.control/this.maxControl),t.fillRect(e,a.SIZE-i-20-s,s,i),t.strokeRect(e,a.SIZE-150-20-s,s,150),t.drawImage(m.shield,e-10,a.SIZE-20-s,40,40),e+=40,t.fillStyle=a.colorDict.green,i=Object(a.lerp)(0,150,this.rudder/this.maxRudder),t.fillRect(e,a.SIZE-i-20-s,s,i),t.strokeRect(e,a.SIZE-150-20-s,s,150),t.drawImage(m.turn,e-10,a.SIZE-20-s,40,40)}};let bt=1,St={};const kt=new i;function It(){kt.setState(i.GAME,Dt,Et),yt.addLevel1Spawns(),dt.rollAll(),y.ocean_ambient.pause(),setTimeout(()=>mt.showMessage("<A   D>",!0),500)}function Et(){ct.clearRect(0,0,a.SIZE,a.SIZE),pt.moveCtx(ct);let t=Math.floor(pt.y/a.MAPW);ct.drawImage(m.map,-a.SIZE,t*a.MAPW,a.MAPW,a.MAPW),ct.drawImage(m.map,-a.SIZE,(t+1)*a.MAPW,a.MAPW,a.MAPW),pt.yAnchor<Tt.y+a.SIZE&&Tt.draw(ct),pt.yAnchor>-a.SIZE&&Tt.drawPreviousIsland(ct),x.draw(ct),ft.forEach(t=>{t.sunk||t.draw(ct)}),wt.forEach(t=>{t.sunk||t.draw(ct)}),mt.draw(ct),gt.forEach(t=>{t.sunk||t.draw(ct)}),xt.forEach(t=>{t.sunk||t.draw(ct)}),mt.drawMessage(ct),ct.resetTransform(),dt.draw(ct),vt.draw(ct),Mt.draw(ct)}function Dt(){if(x.update(),mt.update(),mt.y<Tt.y){if(bt>=4)return console.log("done"),kt.setState(i.CRED,()=>{},()=>{}),void _t();setTimeout(()=>At(),0),kt.setState(i.ISLAND,()=>{},()=>{}),function t(e=0){const s=[m.treasure1,m.treasure2,m.treasure3,m.treasure4,m.treasure5];if(lt.drawImage(s[e],0,0,500,500),lt.drawImage(s[e],0,0,500,500),4==e){let t=new S(["1","2","3","4","5","6"],["grey","grey","grey","grey","grey","grey"]),e=D[bt-1];return t.mapFaces(e.faces,e.colors),t.draw(lt,0,0),t.rotXTarget=Math.PI/4,t.rotYTarget=Math.PI/4,t.draw(lt,500/3,500/3),t.rotXTarget=Math.PI/4+2*Math.PI,t.rotYTarget=Math.PI/4+Math.PI,t.draw(lt,500/3*2,500/3),console.log(t),Object(a.getEl)("continueBtn").disabled=!1,void(Object(a.getEl)("welcome-msg").innerText="You found a new dice!")}setTimeout(()=>t(e+1),500)}(),y.ocean_ambient.play()}yt.update();for(let t=0;t<ft.length;t++){let e=ft[t];e.sunk?ft.splice(t--,1):e.update()}for(let t=0;t<wt.length;t++){let e=wt[t];e.sunk?wt.splice(t--,1):e.update()}for(let t=0;t<gt.length;t++){let e=gt[t];e.sunk?gt.splice(t--,1):e.update()}for(let t=0;t<xt.length;t++){let e=xt[t];e.sunk?xt.splice(t--,1):e.update()}dt.update(),pt.update(),Mt.update(),St=JSON.parse(JSON.stringify(w)),ut.update()}function At(){vt.ammo=vt.maxAmmo,vt.control=vt.maxControl,vt.rudder=vt.maxRudder,console.log("asdf"),mt.reset(),gt.length=0,xt.length=0,ft.length=0,wt.length=0,pt.yAnchor=0,bt++,Tt.y-=1e3,yt.addSpawnsForLevel(bt),dt.resetDice(),dt.addDiceForLevel(bt),dt.rollAll(),console.log(bt,yt.enemiesToSpawn)}function _t(){bt=0,dt.resetDice(),dt.allDice=[],At()}window.gameState=kt,function(){kt.setState(i.MENU,()=>{},()=>{}),h(),Object(a.getEl)("menuDiv").classList.remove("nodisplay"),ct.lineWidth=a.LINEWIDTH,function(){for(let t in d)m[t]=new Image,m[t].src=d[t],m[t].onload=f;for(let t in u)y[t]=new Audio(u[t]),y[t].onloadeddata=f}(),window.addEventListener("keydown",t=>{let e=t.keyCode;1!=w[e]&&(w[e]=!0)}),window.addEventListener("keyup",t=>{let e=t.keyCode;w[e]=!1}),a.canvas.addEventListener("mousedown",t=>{t.preventDefault();let e=t.button;w[e]=!0}),a.canvas.addEventListener("mouseup",t=>{let e=t.button;w[e]=!1}),a.canvas.addEventListener("mousemove",t=>{g.x=Math.round(t.offsetX*a.canvas.width/a.canvas.clientWidth),g.y=Math.round(t.offsetY*a.canvas.height/a.canvas.clientHeight)}),a.canvas.addEventListener("contextmenu",t=>{t.preventDefault()}),pt.setTarget(mt);let t=setInterval(()=>{p()&&(console.log("READY"),Object(a.getEl)("playBtn").disabled=!1,console.log(Object(a.getEl)("playBtn")),mt.setAnimations(),dt.addDiceForLevel(1),console.log(m),clearInterval(t),y.ocean_ambient.loop=!0,y.ocean_ambient.volume=.05,y.ocean_ambient.play(),y.music.loop=!0,y.music.volume=.2,y.music.play())},100)}(),kt.tick()}]);